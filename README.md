# R1_R2s_rel #

**r1_r2s_relaxivity** is a software package designed to calculate the r1-r2* relaxivities. The software is described in the following manuscript:
"Uncovering molecular iron compounds in the living human brain."

```
example= r1_r2s_relaxivity_run(R1_path,R2s_path,Seg_path,1,saveat_path,{'par_max',0.5,'par_min',0.1,'Parameter_str','R1'})
```

For more information, please contact: 

>Aviv Mezer: aviv.mezer(AT)elsc.huji.ac.il
>
>Shir Filo: shir.filo(AT)mail.huji.ac.il

## INPUTS ###

1) R1_path:   Path to a Nifti of a R1 map (in units [1/sec]).

2) R2s_path:   Path to a Nifti of a R2* map (in **units [1/sec]**, with **the same resolusion and in the same space** as the R1 map).

3) Seg_path:   Path to a Nifti of a brain segmentation or a ROI mask (with **the same resolusion and in the same space** as the R1 map). The software will calculate the r1-r2* relaxivities for all ROIs (with lables other than zero) in the segmentation file.

4) save_fig:   1/0 depending on whether or the user would like to save the output (1) or not (0).

5) saveat:   path to a directory where the output will be saved.

6) flags:   every parameter that you would like to be different from default can be given here. This input will be expected to come as a cell arrayand in pairs. There are 2 parameters that can bedefined here: (1) 'R1_max' and (2) 'R1_min' represent the range of values for R1 (to be used in the figures). for example: {'R1_max',0.5,'R1_min',0.1}


## OUTPUTS ###

This function creates and saves the r1_r2s_relaxivity strucure to the 'saveat' directory. In this structure you can find:
*  The different inputs to the function will be saved.
*  The r1-r2* relaxivities will be saved in the fit matrix. This is an MX2 matrix where M is the number of ROIs in the segmentation and the columns are:
	1) the slope of the linear relationship between R1 and R2* (the r1-r2* relaxivity).
	2) the intersection of the linear relationship between R1 and R2*.
*  For each ROI, the data point used to fit the linear relationship between R1 and R2*, generated by binning over these two parameters, are saved in BinR2s and BinR1 respectively. The STD of R1 in each bin is saved in STD.   


## Example Data ###

In this repository you can find the all the Niftis needed for a test run of the r1_r2s_relaxivity software package:
*  R1 map (r1_r2s_rel_toolbox/Example_data/R1_map_Wlin.nii.gz)
*  R2* map (r1_r2s_rel_toolbox/Example_data/R2s_map.nii.gz)
*  Segmentation file with 3 ROIs (r1_r2s_rel_toolbox/Example_data/segmentation.nii.gz)   

For a test run of the software add the r1_r2s_rel_toolbox repository to your path and use the following matlab code:

R1_path='r1_r2s_rel_toolbox/Example_data/R1_map_Wlin.nii.gz';

R2s_path='r1_r2s_rel_toolbox/Example_data/R2s_map.nii.gz';

Seg_path='r1_r2s_rel_toolbox/Example_data/segmentation.nii.gz';

example= r1_r2s_relaxivity_run(R1_path,R2s_path,Seg_path,0,[],{'R1_max',1.5,'R1_min',0.2})

## SOFTWARE REQUIREMENTS ###
  
* MATLAB          - http://www.mathworks.com/products/matlab/
* Vistasoft       - https://github.com/vistalab/vistasoft
* boundedline-pkg - https://github.com/kakearney/boundedline-pkg    
* knkutils        - https://github.com/kendrickkay/knkutils

(C) Mezer lab, the Hebrew University of Jerusalem, Israel, Copyright 2021


